{% extends "base.html" %}
{% block title %}Scan Barcode/QR Code{% endblock %}

{% block content %}

<div class="d-flex flex-column h-100 flex-grow-1">
    <div class="d-flex flex-grow-1 justify-content-center px-3 py-4 p-sm-4 p-lg-5">
        <div class="d-flex w-100 flex-column" style="max-width: 600px;">

            <main class="d-flex flex-column gap-5 pt-4">

                <div class="d-flex flex-column gap-2">
                    <h1 class="fs-2 fw-black lh-sm tracking-neg-3 text-body">
                        Scan Barcode/QR Code
                    </h1>
                    <p class="fs-6 fw-normal text-secondary-emphasis">
                        Scan a code using your webcam or upload an image file.
                    </p>
                </div>

                <div class="d-flex w-100">
                    <div class="nav nav-pills custom-toggle-pill w-100 bg-secondary-subtle rounded-xl p-1">

                        <label class="nav-item flex-grow-1 cursor-pointer">
                            <input checked class="form-check-input visually-hidden" type="radio" name="scan-method" value="upload" id="methodUpload">
                            <a class="nav-link text-center fw-medium rounded-lg py-2 px-3 fs-6 custom-toggle-link active"
                                data-bs-toggle="tab" data-bs-target="#upload-section" aria-current="true">
                                <span class="text-truncate">Upload Image</span>
                            </a>
                        </label>

                        <label class="nav-item flex-grow-1 cursor-pointer">
                            <input class="form-check-input visually-hidden" type="radio" name="scan-method" value="webcam" id="methodWebcam">
                            <a class="nav-link text-center fw-medium rounded-lg py-2 px-3 fs-6 custom-toggle-link"
                                data-bs-toggle="tab" data-bs-target="#webcam-section">
                                <span class="text-truncate">Webcam Scan</span>
                            </a>
                        </label>
                    </div>
                </div>

                <div class="tab-content">

                    <div class="tab-pane fade show active" id="upload-section">
                        <div class="d-flex flex-column align-items-center justify-content-center gap-4 rounded-xl border border-dashed border-secondary-subtle p-5 text-center">

                            <form method="POST" action="{{ url_for('scan_page') }}" enctype="multipart/form-data" class="d-flex flex-column align-items-center w-100 gap-3">
                                <div class="d-flex h-12 w-12 align-items-center justify-content-center rounded-circle bg-primary-subtle text-primary">
                                    <span class="material-symbols-outlined fs-3">upload</span>
                                </div>

                                <p class="fs-5 fw-bold lh-sm tracking-neg-3">Upload an Image</p>

                                <input type="file" id="uploadInput" name="barcode_file" required
                                    class="form-control d-block w-100 cursor-pointer rounded-lg border border-secondary-subtle text-body bg-select-file dark-input-custom" />

                                <button id="scanQR" type="submit"
                                    class="btn btn-primary d-inline-flex align-items-center justify-content-center rounded-lg py-2 px-4 h-lg-2 fw-medium mt-2 transition-colors"
                                    style="min-width: 150px;">
                                    <span class="text-truncate">Scan Image</span>
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="webcam-section">
                        <div class="d-flex flex-column align-items-center justify-content-center gap-4 rounded-xl border border-dashed border-secondary-subtle p-5 text-center">

                            <div class="d-flex h-12 w-12 align-items-center justify-content-center rounded-circle bg-primary-subtle text-primary">
                                <span class="material-symbols-outlined fs-3">photo_camera</span>
                            </div>

                            <div class="d-flex flex-column align-items-center gap-2" style="max-width: 350px;">
                                <p class="fs-5 fw-bold lh-sm tracking-neg-3">Scan with your webcam</p>
                                <p class="small fw-normal text-secondary-emphasis">
                                    Position a barcode or QR code within the frame to scan it.
                                    You may need to grant camera permissions.
                                </p>
                            </div>

                            <button id="startCameraBtn"
                                class="btn btn-primary d-inline-flex align-items-center justify-content-center gap-2 rounded-lg py-2 px-4 h-lg-2 fw-medium transition-colors">
                                <span class="material-symbols-outlined fs-6">videocam</span>
                                <span class="text-truncate">Start Camera</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="d-flex flex-column gap-4 rounded-xl bg-white p-4 shadow-sm dark-card-custom">
                    <p class="fs-5 fw-bold mb-0">Scan Result</p>

                    <div class="d-flex flex-column gap-3">

                        <div class="d-flex align-items-center rounded-lg bg-light p-3 dark-output-bg-custom" style="min-height: 56px;">
                            <p id="scanResultText"
                               class="flex-grow-1 break-all font-monospace small text-body mb-0">
                                {% if scanned_text %}
                                {{ scanned_text }}
                                {% else %}
                                No result yet
                                {% endif %}
                            </p>
                        </div>

                        <div class="d-flex flex-wrap align-items-center justify-content-start gap-3">

                            <button id="openLinkBtn" type="button"
                                class="btn btn-primary d-inline-flex flex-grow-1 flex-sm-grow-0 align-items-center justify-content-center gap-2 rounded-lg py-2 px-4 h-lg-2 fw-medium transition-colors"
                                style="min-width: 140px;">
                                <span class="material-symbols-outlined fs-6">open_in_new</span>
                                <span class="text-truncate">Open Link</span>
                            </button>

                            <button id="copyBtn" type="button"
                                class="btn btn-outline-secondary dark-btn-outline-light d-inline-flex flex-grow-1 flex-sm-grow-0 align-items-center justify-content-center gap-2 rounded-lg py-2 px-4 h-lg-2 fw-medium transition-colors"
                                style="min-width: 140px;">
                                <span class="material-symbols-outlined fs-6">content_copy</span>
                                <span class="text-truncate">Copy to Clipboard</span>
                            </button>

                        </div>
                    </div>
                </div>

            </main>

        </div>
    </div>
</div>

{% endblock %}